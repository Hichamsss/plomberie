<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Mon compte</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body{margin:0;font-family:'Segoe UI',sans-serif;background:#0f172a;color:#fff}
    header{text-align:center;padding:20px;font-size:2em;background:rgba(0,0,0,.3);border-bottom:1px solid #334155}
    .wrap{width:95%;margin:24px auto}
    h2{margin:16px 0 10px}
    .card{background:rgba(255,255,255,.04);border-radius:10px;padding:14px;margin-bottom:18px}
    table{width:100%;border-collapse:collapse;background:rgba(255,255,255,.04);border-radius:10px;overflow:hidden}
    th,td{padding:12px;text-align:left;border-bottom:1px solid rgba(255,255,255,.08)}
    th{background-color:rgba(255,255,255,.06)}
    tr:hover{background-color:rgba(255,255,255,.06)}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:.85em}
    .b-attente{background:#4b5563}
    .b-encours{background:#1d4ed8}
    .b-traite{background:#16a34a}
    .muted{color:#cbd5e1}
  </style>
</head>
<body>
<header>
  Mon compte
  <form th:action="@{/logout}" method="post" style="float:right; margin-top:-10px;">
    <button type="submit" style="
      background:#dc2626;
      border:none;
      color:#fff;
      padding:6px 12px;
      border-radius:6px;
      cursor:pointer;
      font-size:0.9em;
    ">Se déconnecter</button>
  </form>
</header>

<div class="wrap">

  <!-- Infos utilisateur -->
 <div class="card" th:if="${client != null}">
  <h2>Mes informations</h2>
  <div class="muted">
    <div><strong>Nom:</strong> <span th:text="${client.firstname}">Prénom</span></div>
    <div><strong>Email:</strong> <span th:text="${client.email}">email@example.com</span></div>
    <div><strong>Téléphone:</strong> <span th:text="${client.telephone}">-</span></div>
  </div>

  <form th:action="@{/compte/supprimer}" method="post" style="margin-top:15px;display:inline-block;">
    <button type="submit"
            style="background:#dc2626;border:none;color:#fff;padding:8px 14px;border-radius:8px;cursor:pointer;font-size:0.9em;">
      Supprimer mon compte
    </button>
  </form>
</div>
  

  <!-- Bouton laisser un avis si éligible -->
  <div class="card" th:if="${peutLaisserAvis}">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>
        <strong>Vous avez une prestation traitée.</strong>
        <span class="muted">Partagez votre expérience&nbsp;!</span>
      </div>
      <a th:href="@{/avis/nouveau}" style="background:#16a34a;color:#fff;text-decoration:none;padding:8px 12px;border-radius:8px">
        Laisser un avis
      </a>
    </div>
  </div>

  <!-- Mes demandes de devis -->
  <h2>Mes demandes de devis</h2>
  <div class="card" th:if="${#lists.isEmpty(mesDevis)}">
    <span class="muted">Aucune demande de devis pour l’instant.</span>
  </div>
  <table th:if="${!#lists.isEmpty(mesDevis)}">
    <thead>
      <tr>
        <th>#</th>
        <th>Nom</th>
        <th>Email</th>
        <th>Téléphone</th>
        <th>Message</th>
        <th>Statut</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="d : ${mesDevis}">
        <td th:text="${d.id}">1</td>
        <td th:text="${d.nom}">Nom</td>
        <td th:text="${d.email}">email@example.com</td>
        <td th:text="${d.telephone}">-</td>
        <td th:text="${d.message}">Message</td>
        <td>
          <span
            th:classappend="${d.statut != null and d.statut.name() == 'EN_COURS'} ? 'badge b-encours' : (${d.statut != null and d.statut.name() == 'TRAITE'} ? 'badge b-traite' : 'badge b-attente')"
            th:text="${d.statut != null ? d.statut.name() : 'EN_ATTENTE'}">EN_ATTENTE</span>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Mes interventions urgentes -->
  <h2 style="margin-top:24px;">Mes interventions urgentes</h2>
  <div class="card" th:if="${#lists.isEmpty(mesUrgences)}">
    <span class="muted">Aucune intervention urgente soumise.</span>
  </div>
  <table th:if="${!#lists.isEmpty(mesUrgences)}">
    <thead>
      <tr>
        <th>#</th>
        <th>Description</th>
        <th>Première disponibilité</th>
        <th>Téléphone</th>
        <th>Statut</th>
        <th>Paiement</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="u : ${mesUrgences}">
        <td th:text="${u.id}">1</td>
        <td th:text="${u.description != null ? u.description : u.message}">-</td>
        <td th:text="${u.disponibilite != null ? u.disponibilite : '-'}">-</td>
        <td th:text="${u.telephone != null ? u.telephone : '-'}">-</td>
        <td>
          <span
            th:classappend="${u.statut != null and u.statut.name() == 'EN_COURS'} ? 'badge b-encours' :
                            (${u.statut != null and u.statut.name() == 'TRAITE'} ? 'badge b-traite' : 'badge b-attente')"
            th:text="${u.statut != null ? u.statut.name() : 'EN_ATTENTE'}">EN_ATTENTE</span>
        </td>
        <td th:text="${u.stripeSessionId != null and !#strings.isEmpty(u.stripeSessionId) ? 'Payé' : 'Non payé'}">-</td>
      </tr>
    </tbody>
  </table>

</div>
</body>
</html>
